# review-gate

Claude Code でレビューポイントを強制する軽量フレームワーク。

SDD ツールのような永続的な spec 管理はしない。
価値があるのはレビュープロセスであり、spec ドキュメントではないという前提に立つ。

## コマンド

| コマンド | 用途 | レビュー |
|---------|------|---------|
| `/spec "機能の説明"` | 要件定義→設計の厳密レビュー | 各フェーズで承認必須 |
| `/impl` | レビュー済み仕様の実装 | 設計逸脱時のみ確認 |
| `/quick "小さな変更"` | 軽量レビュー（1ターン確認） | 1回の承認で実装開始 |

## フロー

```
/spec "ユーザ認証にOTP追加"
  │
  ├─ Phase 1: 要件整理
  │    └─ サブエージェントレビュー（曖昧さ・考慮漏れ・矛盾を検出）
  │    └─ 指摘を反映 → ユーザに提示 ←→ ユーザレビュー（ループ）
  │
  ├─ Phase 2: 設計提案
  │    └─ サブエージェントレビュー（要件との整合性・過剰設計を検出）
  │    └─ 指摘を反映 → ユーザに提示 ←→ ユーザレビュー（ループ）
  │
  └─ Phase 3: タスク分解
       └─ サブエージェントレビュー（網羅性・粒度・順序を検出）
       └─ .review/ にメモ保存 → 「/impl で開始できます」
            │
/impl
  │
  ├─ plan mode で実装計画
  ├─ タスク単位で実装（逸脱時はユーザ確認）
  ├─ テスト作成
  └─ 完了: CLAUDE.md に知見統合 → .review/ 削除
```

各フェーズでサブエージェント（Task ツール）が別コンテキストからレビューすることで、
メインエージェントの思い込みや盲点をユーザに提示する前に検出する。

## 設計思想

- **spec は使い捨て**: `.review/` は作業中の一時メモ。実装後に削除する
- **残すべき情報は既存の場所へ**: CLAUDE.md（エージェント向け）、README.md（人間向け）
- **プロセスが本体**: ドキュメント管理ではなくレビューの強制が目的
- **段階的な厳密さ**: 大きな変更は `/spec`→`/impl`、小さな変更は `/quick`
- **二重レビュー**: サブエージェントが機械的な品質チェック、人間が意図の確認を担当

## セットアップ

```bash
# .claude/commands/ に3つのコマンドファイルを配置
# CLAUDE.md にレビューゲートのルールを追記
# 以上。他の依存なし。
```

## FAQ

**Q: なぜ spec を永続化しないのか**
A: 実装後の spec は即座に陳腐化する。コードとテストが真の仕様。
アーキテクチャ判断など残す価値のある情報だけを CLAUDE.md に統合する。

**Q: `/spec` と `/quick` の使い分けは？**
A: 影響範囲が複数モジュールにまたがる、設計判断が必要、
要件に不明点が多い → `/spec`。それ以外 → `/quick`。

**Q: サブエージェントレビューのコストは？**
A: 各フェーズで Task ツールを1回呼ぶので、`/spec` 全体で最大3回のサブエージェント起動。
短いテキストのレビューなので各呼び出しは軽い。
人間がレビューで見落としを指摘して手戻りするコストの方がはるかに大きい。

**Q: 既存の SDD ツールとの関係は？**
A: 併用可能だが、このフレームワークは SDD ツールなしで
レビュープロセスだけを最小限に強制することを目的としている。
