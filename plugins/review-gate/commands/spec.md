# /spec - 厳密レビューモード

このコマンドは要件定義→設計の厳密なレビューフローを開始します。
ユーザの入力: $ARGUMENTS

## あなたの振る舞い

あなたはこれから **厳密レビューモード** に入ります。
通常の「すぐ実装する」振る舞いを停止し、以下のフェーズを順に実行してください。
**各フェーズでユーザの明示的な承認がない限り、絶対に次のフェーズに進まないでください。**

---

## Phase 1: 要件整理

ユーザの入力を分析し、以下を **箇条書きではなく散文で** 簡潔にまとめてください:

1. **目的**: この変更で何を達成したいのか（1-2文）
2. **スコープ**: 何をやって、何をやらないのか
3. **不明点**: 入力から読み取れなかった情報を質問として列挙

### 不明点の扱い

不明点がある場合は、まず質問してください。
質問は一度に3つまでに絞り、優先度の高いものから聞いてください。
推測で埋めて進めることは禁止です。

### エージェントによるレビュー

要件をまとめたら、**ユーザに提示する前に** `requirements-reviewer` エージェントを起動してレビューさせてください。

```
Task(
  subagent_type="requirements-reviewer",
  description="要件レビュー",
  prompt="""
以下の要件をレビューしてください。

## レビュー対象
{ここに要件の内容を埋め込む}
"""
)
```

レビュー結果を受けて:
- 指摘があれば要件を改善してから、**指摘内容とその対応をまとめて** ユーザに提示する
- 指摘なしならそのままユーザに提示する

### 承認の確認

要件を提示したら、必ず以下のように聞いてください:

> この理解で合っていますか？修正点があれば教えてください。

ユーザが承認（"ok", "lgtm", "いいよ", "進めて" 等）するまでこのフェーズに留まってください。
修正が入ったら要件を更新して再度確認を求めてください。
**修正が大きい場合は再度エージェントレビューを実行してください。**

---

## Phase 2: 設計

要件が承認されたら、設計フェーズに移行します。

以下を提示してください:

1. **アプローチ**: どう実装するかの方針（技術選定、アーキテクチャ判断）
2. **影響範囲**: 変更が及ぶファイル・モジュールのリスト
3. **リスク・トレードオフ**: 代替案があれば比較。判断に迷う点があれば明示
4. **確認事項**: 設計上の判断でユーザに委ねたい点

### エージェントによるレビュー

設計をまとめたら、**ユーザに提示する前に** `design-reviewer` エージェントを起動してレビューさせてください。

```
Task(
  subagent_type="design-reviewer",
  description="設計レビュー",
  prompt="""
以下の要件と設計を照合し、レビューしてください。

## 承認済みの要件
{ここに承認済みの要件を埋め込む}

## レビュー対象の設計
{ここに設計の内容を埋め込む}
"""
)
```

レビュー結果を受けて:
- 指摘があれば設計を改善してから、**指摘内容とその対応をまとめて** ユーザに提示する
- 指摘なしならそのままユーザに提示する

### 承認の確認

> この設計方針で進めてよいですか？

ユーザが承認するまでこのフェーズに留まってください。

---

## 保存と完了

設計が承認されたら:

1. `.review/` ディレクトリに作業メモを保存（形式は後述）
2. ユーザに以下を伝える:

> レビュー完了。`/review-gate:tasks {slug}` でタスク分解に進めます。

**このコマンドの中で実装やタスク分解を開始してはいけません。**

---

## Phase 遷移

| 操作 | 前提条件 | 遷移先 |
|------|---------|--------|
| /review-gate:spec | なし | phase: design |
| /review-gate:tasks | phase: design 以降 | phase: tasks-ready |
| /review-gate:impl | phase: tasks-ready 以降 | phase: implementing → done |

---

## 作業メモの保存形式

`.review/` に以下を作成:

```
.review/
└── {slug}.md
```

ファイル内容は以下の形式:

```markdown
---
feature: {slug}
started: {date}
phase: design
---

# {機能名}

## 要件
{承認された要件の要約}

## 設計
{承認された設計方針の要約}
```

slug はユーザの入力から適切な英語のケバブケースで生成してください。

このファイルは実装中の参照用であり、永続的なドキュメントではありません。
